script
  :uglify
    (function() {
      // until metrika is loaded, make the stub
      window.metrika = {
        reachGoal: function() {}
      };

      window.yandex_metrika_callbacks = [function() {
        try {
          window.metrika = new Ya.Metrika({
            id: 17649010,
            webvisor: true,
            clickmap: true,
            params: {
              user: window.currentUser && window.currentUser.id
            }
          });
          metrika.trackLinks({delay: 150});

          window.addEventListener('error', function(e) {
            window.metrika.reachGoal('JSERROR', {
              src: (e.filename || e.errorUrl) + ': ' + (e.lineno || e.errorLine),
              stack: e.stack || (e.error && e.error.stack),
              message: e.message
            });
          });
        } catch (e) {
        }
      }];
    })();

script(src="//mc.yandex.ru/metrika/watch.js" async)
