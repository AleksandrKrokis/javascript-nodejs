webpackJsonp([3],{0:function(t,e,n){"use strict";var i=n(53),s=n(54),o=n(55);e.init=function(){new i,new s,new o},window.profile=t.exports},1:function(t){"use strict";function e(t,e){for(var n=t.target;n;){if(n.matches(e))return n;if(n==t.currentTarget)break;n=n.parentElement}return null}function n(t,n,i,s,o){t.addEventListener(i,function(t){var i=e(t,n);t.delegateTarget=i,i&&s.call(o||this,t)})}n.delegateMixin=function(t){t.delegate=function(t,e,i){n(this.elem,t,e,i,this)}},t.exports=n},2:function(t,e,n){"use strict";function i(t){function e(t,e){var n=new CustomEvent(t);return n.originalEvent=e,n}function n(t,n){var i=e("fail",n);i.reason=t,o.dispatchEvent(i)}function i(t,n){var i=e("success",n);i.result=t,o.dispatchEvent(i)}var o=new XMLHttpRequest,a=t.method||"GET",r=t.body,l=t.url;window.csrf&&(l=s(l,"_csrf",window.csrf)),"[object Object]"=={}.toString.call(r)&&(o.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r=JSON.stringify(r)),o.open(a,l,t.sync?!1:!0),o.method=a,t.noGlobalEvents||(o.addEventListener("loadstart",function(t){var n=e("xhrstart",t);document.dispatchEvent(n)}),o.addEventListener("loadend",function(t){var n=e("xhrend",t);document.dispatchEvent(n)}),o.addEventListener("success",function(t){var n=e("xhrsuccess",t);n.result=t.result,document.dispatchEvent(n)}),o.addEventListener("fail",function(t){var n=e("xhrfail",t);n.reason=t.reason,document.dispatchEvent(n)})),t.json&&o.setRequestHeader("Accept","application/json"),o.setRequestHeader("X-Requested-With","XMLHttpRequest");var c=t.successStatuses||[200];return o.addEventListener("error",function(t){n("Ошибка связи с сервером.",t)}),o.addEventListener("timeout",function(t){n("Превышено максимально допустимое время ожидания ответа от сервера.",t)}),o.addEventListener("abort",function(t){n("Запрос был прерван.",t)}),o.addEventListener("load",function(e){if(!o.status)return void n("Не получен ответ от сервера.",e);if(-1==c.indexOf(o.status))return void n("Ошибка на стороне сервера (код "+o.status+"), попытайтесь позднее",e);var s=o.responseText,a=o.getResponseHeader("Content-Type");if(a.match(/^application\/json/)||t.json)try{s=JSON.parse(s)}catch(e){return void n("Некорректный формат ответа от сервера",e)}i(s,e)}),setTimeout(function(){o.send(r)},0),o}function s(t,e,n){var i=encodeURIComponent(e)+"="+encodeURIComponent(n);return~t.indexOf("?")?t+"&"+i:t+"?"+i}n(4),t.exports=i},4:function(t,e,n){"use strict";var i=function(t){return t&&(t["default"]||t)},s=i(n(3));document.addEventListener("xhrfail",function(t){new s.Error(t.reason)})},53:function(t,e,n){"use strict";function i(){this.elem=document.body,this.delegate('[data-action="provider-add"]',"click",function(t){t.preventDefault(),this.addProvider(t.delegateTarget.dataset.provider)}),this.delegate('[data-action="provider-remove"]',"click",function(t){t.preventDefault(),this.removeProvider(t.delegateTarget.dataset.provider)})}var s=n(1),o=n(3),a=n(2);i.prototype.addProvider=function(t){this.openAuthPopup("/auth/connect/"+t)},i.prototype.removeProvider=function(t){var e=a({method:"POST",url:"/auth/disconnect/"+t});e.addEventListener("success",function(){window.location.reload()}),e.send()},i.prototype.openAuthPopup=function(t){this.authPopup&&!this.authPopup.closed&&this.authPopup.close();var e=800,n=600,i=(window.outerHeight-n)/2,s=(window.outerWidth-e)/2;window.authProvidersManager=this,this.authPopup=window.open(t,"authProvidersManager","width="+e+",height="+n+",scrollbars=0,top="+i+",left="+s)},i.prototype.onAuthSuccess=function(){window.location.reload()},i.prototype.onAuthFailure=function(t){new o.Error(t||"Отказ в авторизации.","error")},s.delegateMixin(i.prototype),t.exports=i},54:function(t,e,n){"use strict";function i(){this.elem=document.body.querySelector('[data-action="photo-change"]'),this.elem.addEventListener("click",function(t){t.preventDefault(),this.changePhoto()}.bind(this))}var s=n(1),o=n(2),a=n(3);i.prototype.changePhoto=function(){var t=document.createElement("input");t.type="file";var e=this;t.onchange=function(){e.upload(this.files[0])},t.click()},i.prototype.updateUserPhoto=function(t){this.elem.style.backgroundImage='url("'+t.replace(/(\.\w+)$/,window.devicePixelRatio>1?"m$1":"t$1")+'")'},i.prototype.upload=function(t){var e=new FormData;e.append("photo",t);var n=o({method:"PATCH",url:"/users/me",json:!0,body:e});n.successStatuses=[200,400];var i=this;n.addEventListener("success",function(t){return 400==this.status?void new a.Error("Неверный тип файла или изображение повреждено."):void i.updateUserPhoto(t.result.photo)})},s.delegateMixin(i.prototype),t.exports=i},55:function(t,e,n){"use strict";var i=n(1),s=n(2),o=n(3),a=n(6),r=function(){var t=function(){this.elem=document.body.querySelector(".profile__content"),this.delegate(".profile__item_editable","click",function(t){t.delegateTarget.classList.add("profile__item_editing");var e=t.delegateTarget.querySelector("[autofocus]");e&&e.focus()}),this.delegate('form[data-field="displayName"]',"submit",this.onDisplayNameSubmit),this.delegate(".profile__item-cancel","click",function(t){t.delegateTarget.closest(".profile__item_editable").classList.remove("profile__item_editing"),t.delegateTarget.closest(".profile__item_editable").classList.remove("profile__item_editing")})};return t.prototype.onDisplayNameSubmit=function(t){t.preventDefault();var e=t.delegateTarget,n=e.elements.displayName,i=n.value;if(!i)return void new o.Error("Отсутствует значение.");var s=this.request(e.querySelector('[type="submit"]'),new FormData(e));s.addEventListener("success",function(){400==s.status?(n.closest(".text-input").classList.remove("text-input_invalid"),new o.Success("Сохранено. Изменение будет видно после перезагрузки страницы.")):(n.closest(".text-input").classList.add("text-input_invalid"),new o.Error("Ошибка"))})},t.prototype.request=function(t,e){var n=this,i=s({method:"PATCH",url:"/users/me",body:e});return i.addEventListener("loadstart",function(){var e=n.startRequestIndication(t);i.addEventListener("loadend",e)}),i},t.prototype.startRequestIndication=function(t){var e=new a({elem:t,size:"small","class":"submit-button__spinner",elemClass:"submit-button_progress"});return e.start(),function(){e.stop()}},t}();i.delegateMixin(r.prototype),t.exports=r}});